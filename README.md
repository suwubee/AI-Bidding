# 文档结构分析工具

一个基于Python Flask的智能文档解析工具，支持PDF、DOC、DOCX格式文档的结构分析，能够自动识别1-7级标题并生成可视化的文档结构树。

## 功能特性

- 📄 **多格式支持**：支持PDF、DOC、DOCX文档格式，单文件最大1GB
- 🔖 **智能书签解析**：优先识别PDF书签结构，准确提取标题层级
- 🏗️ **多重解析策略**：书签解析 → 样式识别 → 文本分析，确保最佳效果
- 👤 **会话管理系统**：基于session的用户隔离，自动生成唯一ID
- 📁 **文件管理功能**：支持文件统计、批量清空、自动清理过期文件
- 🌳 **可视化展示**：生成直观的文档结构树
- 📊 **详细统计分析**：文档信息、提取方式、分析时间等
- 🎨 **现代化界面**：响应式设计，支持拖拽上传
- 🔍 **内容预览**：提供文档内容预览功能

## 技术栈

- **后端**：Python 3.7+, Flask 2.3+
- **文档解析**：PyPDF2, python-docx
- **前端**：Bootstrap 5, JavaScript ES6
- **样式**：CSS3, Font Awesome图标

## 安装说明

### 1. 克隆项目

```bash
git clone <repository-url>
cd AI-Bidding
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 运行应用

```bash
python app.py
```

应用将在 `http://localhost:5000` 启动。

## 使用方法

1. **上传文档**：
   - 点击上传区域选择文件，或直接拖拽文件到上传区域
   - 支持的格式：PDF, DOC, DOCX
   - 文件大小限制：1GB

2. **分析文档**：
   - 点击"开始分析"按钮
   - 系统将自动解析文档结构

3. **查看结果**：
   - 文档基本信息（类型、页数、标题数量等）
   - 标题层级统计
   - 文档结构树
   - 内容预览

4. **文件管理**：
   - 查看会话ID和文件统计信息
   - 一键清空所有上传文件
   - 自动清理24小时以上的过期文件

## 支持的文档格式

### PDF文档（智能书签优先）
- **🎯 多策略书签解析**：3种不同的书签解析算法，自动选择最佳结果
- **🔍 质量验证系统**：自动验证书签解析质量，过滤无效结果
- **⚡ 智能降级机制**：书签失效时自动降级到精确文本分析
- **🛠️ 层级优化算法**：自动修复和优化标题层级关系
- 支持中英文混合文档，详细调试信息

### Word文档（大纲结构优先）
- **📊 大纲级别识别**：优先读取Word文档的outline level结构
- **🎨 标题样式解析**：精确识别Heading 1-7样式和字体特征
- **🔧 层级智能修复**：自动检测和修复层级跳跃问题
- **✅ 质量验证过滤**：移除重复标题和无效匹配
- **📝 详细调试输出**：完整的解析过程追踪

## 标题识别规则

工具支持多种中文文档的标题格式（按优先级排序）：

### 主要标题模式（1-7级）
1. **章节格式**：第一章、第二章... （1级）
2. **节的格式**：第一节、第二节... （2级）
3. **条款格式**：第一条、第二条... （3级）
4. **数字格式**：1.、2.、3.... （4级）
5. **二级数字**：1.1、1.2、2.1... （5级）
6. **三级数字**：1.1.1、1.1.2... （6级）
7. **四级数字**：1.1.1.1、1.1.1.2... （7级）

### 次要标题模式（5-7级）
- **中文数字**：一、二、三...
- **括号格式**：（一）、（二）...
- **英文字母**：A.、B.、C...

### 智能特性
- **层级跳跃检测**：自动修复1级直接跳到4级等不合理结构
- **重复检测**：自动移除重复的标题
- **质量过滤**：过滤纯数字、标点符号等无效匹配
- **长度验证**：标题长度限制在3-150字符范围内

## API接口

### 文档分析接口

```
POST /api/analyze
Content-Type: multipart/form-data

参数：
- file: 文档文件

响应：
{
    "success": true,
    "filename": "文档名称.pdf",
    "structure": {
        "document_type": "PDF",
        "total_pages": 10,
        "headings": [...],
        "structure": [...],
        "content_preview": "..."
    }
}
```

## 项目结构

```
AI-Bidding/
├── app.py              # Flask主应用
├── document_parser.py  # 文档解析模块
├── requirements.txt    # 依赖包列表
├── README.md          # 项目说明
├── templates/         # HTML模板
│   └── index.html
├── static/           # 静态资源
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── app.js
└── uploads/          # 临时上传目录（自动创建）
```

## 开发说明

### 核心模块

1. **DocumentParser**：文档解析核心类
   - `parse_document()`: 主解析方法
   - `_parse_pdf()`: PDF解析
   - `_parse_docx()`: Word文档解析
   - `_extract_headings_from_text()`: 文本标题提取
   - `_build_document_structure()`: 构建结构树

2. **Flask路由**：
   - `/`: 主页面
   - `/upload`: 文件上传处理
   - `/api/analyze`: API接口

### 扩展开发

如需添加新的文档格式支持：

1. 在`DocumentParser`类中添加对应的解析方法
2. 更新`parse_document`方法中的格式判断
3. 在前端添加相应的文件类型支持

## 注意事项

- 文件上传大小限制为1GB
- 上传的文件会保存到用户专属文件夹，24小时后自动清理
- 每个用户会话有唯一的ID，确保文件隔离
- 部分PDF文档可能因为编码问题导致解析效果不佳
- Word文档建议使用标准的标题样式以获得最佳解析效果
- 建议定期清理不需要的文件以释放服务器空间

## 故障排除

### 常见问题

1. **PDF解析失败**：
   - 检查PDF是否为扫描版（图片格式）
   - 尝试使用其他PDF阅读器确认文档完整性

2. **Word文档标题识别不准确**：
   - 检查文档是否使用了标准的标题样式
   - 确认文档格式为.docx而非.doc

3. **上传失败**：
   - 检查文件大小是否超过1GB
   - 确认文件格式正确

4. **Loading界面卡住**：
   - 刷新页面重新尝试
   - 检查网络连接是否稳定

5. **会话文件管理问题**：
   - 每个浏览器会话有独立的文件空间
   - 清除浏览器缓存会创建新的会话ID

## 许可证

本项目采用MIT许可证。详情请参见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进项目。

---

**开发者**：AI Assistant  
**版本**：1.0.0  
**更新日期**：2024年 